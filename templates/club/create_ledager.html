{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <form method="POST" hx-target="#form-container">
        {% csrf_token %}

        <!-- Ledager form -->
        <div class="form-group">
            <h3>Ledager Information</h3>
            {{ ledager_form.as_p }}
        </div>

        <!-- Table to display columns dynamically -->
        <table class="table table-bordered table-striped table-hover shadow-sm p-3 mb-3">
            <thead class="table-dark">

                <tr>

                </tr>
             
            </thead>
            <tbody>
                <tr>
                    <!-- Render input fields dynamically in rows -->
                    {% for form in column_head_formset %}
                        <td class="text-center">
                            {{ form.column_name }} <!-- Render the input field for column_name -->
                        </td>
                    {% endfor %}
                </tr>
            </tbody>
        </table>

        <!-- Formset container (includes management form for tracking the formset state) -->
        <div id="form-container">
            {{ column_head_formset.management_form.as_p }}
        </div>

        <!-- Button to add another column form -->
        <div class="col-auto">
            <button  id="col_adding_btn" type="button" class="btn btn-secondary mb-3" 
                    hx-post="{% url 'club:add_column_head_form' %}"
                    hx-target="thead tr"
                    hx-swap="beforeend">
                <i class="fas fa-plus"></i> Add Another Column
            </button>

            <button type="submit" class="btn btn-primary mb-3">
                Make New Record / Add New Book
            </button>
        </div>
    </form>
</div>

<script>
    let total_forms = {{ column_head_formset.management_form.TOTAL_FORMS.value }};
    document.querySelector('#col_adding_btn').addEventListener('click', function(event) {
        // Increment the TOTAL_FORMS value when a new column is added
        const input = document.getElementById('id_column_head_form-TOTAL_FORMS');
        let currentValue = parseInt(input.value, 10) || 0;
        input.value = currentValue + 1;
        setTimeout(function() {
            
            let elements = document.querySelectorAll('.column-head-form-container');
            let lastElement = elements[elements.length - 1]; // Last element with the class
            let lastChild = lastElement.lastElementChild.firstElementChild; // Last child of the last element
            lastChild.id = `id_column_head_form-${input.value-1}-column_title`
            lastChild.name = `id_column_head_form-${input.value-1}-column_title`
            lastElement.lastElementChild.lastElementChild.id = `id_column_head_form-${input.value-1}-basemodel_ptr`
              lastElement.lastElementChild.lastElementChild.name = `column_head_form-${input.value-1}-basemodel_ptr`
            console.log("Last child of the last element:", lastChild);
          }, 2000);  // Wait 1000ms (1 second) before executing the code
          
    
    
    });
    
  
    
    

     
      
        
     

        
    

    
</script>
{% endblock %}
